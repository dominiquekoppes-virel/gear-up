---
layout: none
---
{
  {%- assign i = 0 -%}
  {%- for page in site.html_pages -%}
    {%- if page.search_exclude != true -%}
      {%- assign page_content = page.content -%}
      {%- assign heading_level = site.search.heading_level | default: 2 -%}
      {%- for j in (2..heading_level) -%}
        {%- assign tag = 'h' | append: j -%}
        {%- assign anchor_template = '<a id="§ID§" class="anchor-heading" href="#§ID§" aria-labelledby="§ID§"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a>' -%}
        {%- assign page_content = page_content | replace: anchor_template, '' -%}
        {%- assign opening_tag = '<' | append: tag -%}
        {%- assign closing_tag = '</' | append: tag | append: '>' -%}
        {%- assign page_content = page_content | split: opening_tag -%}
        {%- assign offset = 1 -%}
        {%- if j == 2 -%}
          {%- assign offset = 0 -%}
        {%- endif -%}
        {%- for k in (offset..page_content.size) -%}
          {%- unless page_content[k] == nil -%}
            {%- assign section_content = page_content[k] | split: closing_tag | first -%}
            {%- capture section_heading -%}{{ section_content | split: '>' | first | replace: 'id="', '' | replace: '"', '' }}{%- endcapture -%}
            {%- capture section_content -%}{{ section_content | split: '>' | last | strip_html | strip | normalize_whitespace | truncate: 500 }}{%- endcapture -%}
            {%- assign section_url = page.url | append: '#' | append: section_heading -%}
            {%- if section_heading != blank and section_content != blank -%}
              {%- unless i == 0 -%},{%- endunless -%}
              "{{ i }}": {
                "title": "{{ section_heading | strip_html | strip | jsonify }}",
                "content": "{{ section_content | jsonify }}",
                "url": "{{ section_url | relative_url | jsonify }}",
                "relUrl": "{{ section_url | jsonify }}"
              }
              {%- assign i = i | plus: 1 -%}
            {%- endif -%}
          {%- endunless -%}
        {%- endfor -%}
      {%- endfor -%}
      {%- unless page.content == empty -%}
        {%- assign page_content = page.content | strip_html | strip | normalize_whitespace | truncate: 500 -%}
        {%- unless i == 0 -%},{%- endunless -%}
        "{{ i }}": {
          "title": "{{ page.title | strip_html | strip | jsonify }}",
          "content": "{{ page_content | jsonify }}",
          "url": "{{ page.url | relative_url | jsonify }}",
          "relUrl": "{{ page.url | jsonify }}"
        }
        {%- assign i = i | plus: 1 -%}
      {%- endunless -%}
    {%- endif -%}
  {%- endfor -%}
}
